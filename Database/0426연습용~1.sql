CREATE TABLE G_CLASS
(
    CLASS_ID        CHAR(5)         NOT NULL,
    CLASS_NAME      VARCHAR(30)     NOT NULL,
    YEAR_PRICE      NUMBER(10)      NOT NULL
);

INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL001','사장',10000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL002','부장',7000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL003','차장',6000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL004','과장',5000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL005','대리',4000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL006','사원',3000000);
INSERT INTO G_CLASS (CLASS_ID, CLASS_NAME, YEAR_PRICE) VALUES ('CL007','인턴',2000000);

CREATE TABLE G_PART
(
    PART_ID         CHAR(5)         NOT NULL,
    PART_NAME       VARCHAR(30)     NOT NULL,
    PART_LVE        NUMBER(3)       NOT NULL,
    PART_SEQ        NUMBER(3)       NOT NULL,
    PARENT_PART_ID  CHAR(5)         NULL
);

INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT001','ROOT', 0, 1, NULL);
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT002','전체인사부', 1, 2, 'PT001');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT003','전체기획부', 1, 1, 'PT001');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT004','전체판매부', 1, 3, 'PT001');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT005','액션판매부', 2, 6, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT006','캐주얼판매부', 2, 7, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT007','롤플레잉판매부', 2, 1, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT008','스포츠판매부', 2, 2, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT009','퍼즐판매부', 2, 8, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT010','어드벤처판매부', 2, 5, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT011','시물레이션판매부', 2, 3, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT012','아케이드판매부', 2, 4, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT013','FPS판매부', 2, 10, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT014','호러판매부', 2, 9, 'PT004');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT015','액션판매광고팀', 3, 1, 'PT005');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT016','액션배송팀', 3, 2, 'PT005');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT017','액션재고관리팀', 3, 3, 'PT005');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT018','액션재고구매팀', 3, 4, 'PT005');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT019','FPS판매광고팀', 3, 1, 'PT013');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT020','FPS배송팀', 3, 2, 'PT013');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT021','FPS재고관리팀', 3, 3, 'PT013');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT022','액션재고구매팀-1', 4, 1, 'PT018');
INSERT INTO G_PART (PART_ID, PART_NAME, PART_LVE, PART_SEQ, PARENT_PART_ID) VALUES('PT023','액션재고구매팀-2', 4, 2, 'PT018');

CREATE TABLE G_EMPLOYEE
(
    E_ID        CHAR(5)     NOT NULL,
    E_NAME      VARCHAR(30) NOT NULL,
    CLASS_ID    CHAR(5)     NOT NULL,
    PART_ID     CHAR(5)     NOT NULL
);

INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0001','스타사장','CL001', 'PT001');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0002','커맨드센터','CL002', 'PT002');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0003','넥서스','CL002', 'PT003');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0004','해처리','CL002', 'PT004');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0005','드론','CL003', 'PT005');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0006','저글링','CL003', 'PT006');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0007','히드라','CL003', 'PT007');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0008','럴커','CL003', 'PT008');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0009','라바','CL003', 'PT009');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0010','뮤탈리스크','CL003', 'PT010');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0011','디바우러','CL004', 'PT011');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0012','가디언','CL004', 'PT012');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0013','울트라리스크','CL004', 'PT0013');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0014','감염된테란','CL004', 'PT014');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0015','성큰','CL004', 'PT015');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0016','스포닝풀','CL004', 'PT016');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0017','뮤탈둥지','CL005', 'PT017');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0018','퀸','CL005', 'PT018');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0019','레어','CL005', 'PT019');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0020','하이브','CL005', 'PT020');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0021','캐리건','CL005', 'PT021');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0022','질럿','CL005', 'PT022');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0023','드라군','CL005', 'PT023');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0024','캐리어','CL005', 'PT023');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0025','스카우터','CL006', 'PT022');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0026','메딕','CL006', 'PT021');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0027','파이어뱃','CL006', 'PT020');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0028','벌처','CL006', 'PT019');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0029','골리앗','CL006', 'PT018');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0030','시즈탱크','CL006', 'PT017');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0031','고스트','CL006', 'PT016');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0032','마린','CL006', 'PT015');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0033','SCV','CL006', 'PT014');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0034','프로브','CL007', 'PT013');
INSERT INTO G_EMPLOYEE (E_ID, E_NAME, CLASS_ID, PART_ID) VALUES('E0035','레이스','CL007', 'PT012');

--COMMIT;

SELECT *
FROM G_PART T1--, G_EMPLOYEE T2
START WITH PART_ID = 'PT001'
CONNECT BY PRIOR PART_ID = PARENT_PART_ID
;

------------------------------------------------5일차
-- 액션재고관리팀과 액션재고구매팀에 소속된 사원의 이름과 연봉을 구하시오

SELECT T1.PART_NAME, T2.PART_NAME, T3.PART_NAME, T4.PART_NAME, T5.E_NAME, T6.CLASS_NAME, T6.YEAR_PRICE
FROM G_PART T1, G_PART T2, G_PART T3, G_PART T4, G_EMPLOYEE T5, G_CLASS T6
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
AND T2.PART_ID(+) = T3.PARENT_PART_ID
AND T3.PART_ID(+) = T4.PARENT_PART_ID
AND T5.PART_ID = T4.PART_ID
AND T5.CLASS_ID = T6.CLASS_ID
AND ((T4.PART_NAME = '액션재고관리팀' OR T3.PART_NAME = '액션재고관리팀') 
OR (T4.PART_NAME = '액션재고구매팀' OR T3.PART_NAME = '액션재고구매팀'))
;

--FPS와 관련된 부서의 평균 연봉을 구하고 이렇게 표시하시오
SELECT T3.PART_NAME, T4.PART_NAME, AVG(T6.YEAR_PRICE)
FROM G_PART T1, G_PART T2, G_PART T3, G_PART T4, G_EMPLOYEE T5, G_CLASS T6
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
AND T2.PART_ID(+) = T3.PARENT_PART_ID
AND T3.PART_ID(+) = T4.PARENT_PART_ID
AND T5.PART_ID = T4.PART_ID
AND T5.CLASS_ID = T6.CLASS_ID
AND (T4.PART_NAME LIKE 'FPS판매%' OR T3.PART_NAME LIKE 'FPS판매%')
GROUP BY T3.PART_NAME, T4.PART_NAME
;
--
CREATE OR REPLACE PROCEDURE MAKE_USUSAWON
(
    IN_PART_ID  CHAR,
    IN_CLASS_ID CHAR
)
AS
BEGIN
    UPDATE G_EMPLOYEE
    SET E_NAME = '우수사원' || E_NAME
    WHERE 
    E_ID = (
    SELECT E_ID
    FROM G_PART T1, G_EMPLOYEE T2, G_CLASS T3
    WHERE T1.PART_ID = T2.PART_ID
    AND T2.CLASS_ID = T3.CLASS_ID
    AND T2.PART_ID = IN_PART_ID
    AND T3.CLASS_NAME = IN_CLASS_ID
    )
    ;
END MAKE_USUSAWON
;