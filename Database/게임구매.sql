CREATE TABLE G_GAMES
(
    GID CHAR(4) NOT NULL PRIMARY KEY,
    GNAME VARCHAR2(120) NOT NULL,
    GEID CHAR(5) NOT NULL,
    GPRICE NUMBER(6) NOT NULL
);

INSERT INTO G_GAMES VALUES('G001','오버워치®','GE009',22500);
INSERT INTO G_GAMES VALUES('G002','오버워치®:레전더리 에디션','GE009',45000);
INSERT INTO G_GAMES VALUES('G003','스타크래프트®:리마스터','GE007',16500);
INSERT INTO G_GAMES VALUES('G004','스타크래프트®:리마스터+카툰','GE007',29700);
INSERT INTO G_GAMES VALUES('G005','스타크래프트®:카툰','GE007',13200);
INSERT INTO G_GAMES VALUES('G006','스타크래프트Ⅱ®:캠페인 컬렉션','GE007',36000);
INSERT INTO G_GAMES VALUES('G007','워크래프트Ⅲ®:리포지드','GE007',36000);
INSERT INTO G_GAMES VALUES('G008','디아블로Ⅱ®:레저렉션','GE003',48000);
INSERT INTO G_GAMES VALUES('G009','디아블로Ⅲ®:이터널 컬렉션','GE003',45000);
INSERT INTO G_GAMES VALUES('G010','디아블로Ⅲ®:대악마판','GE003',30000);
INSERT INTO G_GAMES VALUES('G011','디아블로Ⅲ®','GE003',16000);
INSERT INTO G_GAMES VALUES('G012','디아블로Ⅲ®:대악마 컬렉션','GE003',72000);
INSERT INTO G_GAMES VALUES('G013','콜 오브 듀티®:블랙 옵스 콜드 워 - 얼티밋 에디션','GE009',85000);
INSERT INTO G_GAMES VALUES('G014','콜 오브 듀티®:블랙 옵스 콜드 워','GE009',49000);
INSERT INTO G_GAMES VALUES('G015','콜 오브 듀티®:모던 워페어','GE009',45000);
INSERT INTO G_GAMES VALUES('G016','콜 오브 듀티®:블랙 옵스4 - 디지털 디럭스 에디션','GE009',49000);
INSERT INTO G_GAMES VALUES('G017','콜 오브 듀티®:블랙 옵스4','GE009',45000);
INSERT INTO G_GAMES VALUES('G018','콜 오브 듀티®:블랙 옵스4 - 배틀 에디션','GE009',30000);
INSERT INTO G_GAMES VALUES('G019','콜 오브 듀티®:모던워페어2 캠페인 리마스터','GE009',28400);
INSERT INTO G_GAMES VALUES('G020','The Witcher 3: Wild Hunt','GE003',34800);
INSERT INTO G_GAMES VALUES('G021','The Witcher 3: Wild Hunt - Game of the Year Edition','GE003',34800);
INSERT INTO G_GAMES VALUES('G022','배틀그라운드','GE009',32000);
INSERT INTO G_GAMES VALUES('G023','Fall Guys: Ultimate Knockout','GE002',20500);
INSERT INTO G_GAMES VALUES('G024','Grand Theft Auto V: Premium Edition','GE001',33000);
INSERT INTO G_GAMES VALUES('G025','Monster Hunter: World','GE001',34900);
INSERT INTO G_GAMES VALUES('G026','Monster Hunter World: Iceborne Digital Deluxe','GE001',58100);
INSERT INTO G_GAMES VALUES('G027','Dead by Daylight','GE001',21000);
INSERT INTO G_GAMES VALUES('G028','The Sims™ 4','GE002',38500);
INSERT INTO G_GAMES VALUES('G029','Among Us','GE002',38500);
INSERT INTO G_GAMES VALUES('G030','DJMAX RESPECT V','GE002',49800);
INSERT INTO G_GAMES VALUES('G031','RESIDENT EVIL 2 / BIOHAZARD RE:2 Standard Edition','GE010',45600);
INSERT INTO G_GAMES VALUES('G032','RESIDENT EVIL 2 / BIOHAZARD RE:2 Deluxe Edition','GE010',56700);
INSERT INTO G_GAMES VALUES('G033','RESIDENT EVIL 3','GE010',68400);
INSERT INTO G_GAMES VALUES('G034','Football Manager 2021','GE004',54000);
INSERT INTO G_GAMES VALUES('G035','A Dance of Fire and Ice','GE008',6500);
INSERT INTO G_GAMES VALUES('G036','Rhythm Doctor','GE008',16500);
INSERT INTO G_GAMES VALUES('G037','SUPERHOT','GE001',27000);
INSERT INTO G_GAMES VALUES('G038','Half-Life: Alyx','GE009',61000);
INSERT INTO G_GAMES VALUES('G039','THE BINDING OF ISAAC: REBIRTH COMPLETE BUNDLE','GE008',53000);
INSERT INTO G_GAMES VALUES('G040','It Takes Two','GE005',44000);
INSERT INTO G_GAMES VALUES('G040','Ghostrunner','GE001',35000);
INSERT INTO G_GAMES VALUES('G041','OUTRIDERS','GE006',70920);
INSERT INTO G_GAMES VALUES('G042','NieR Replicant™ ver.1.22474487139...','GE006',35000);
INSERT INTO G_GAMES VALUES('G043','Devil May Cry 5','GE001',27000);
INSERT INTO G_GAMES VALUES('G044','Red Dead Redemption 2','GE006',66000);
INSERT INTO G_GAMES VALUES('G045','RRed Dead Redemption 2: Ultimate Edition','GE006',110000);

SELECT * FROM G_GAMES;

CREATE TABLE G_GENRE
(
    GEID CHAR(5) NOT NULL,
    GENAME VARCHAR2(30) NOT NULL
);

INSERT INTO G_GENRE VALUES('GE001', '액션');
INSERT INTO G_GENRE VALUES('GE002', '캐주얼');
INSERT INTO G_GENRE VALUES('GE003', '롤플레잉');
INSERT INTO G_GENRE VALUES('GE004', '스포츠');
INSERT INTO G_GENRE VALUES('GE005', '퍼즐');
INSERT INTO G_GENRE VALUES('GE006', '어드벤처');
INSERT INTO G_GENRE VALUES('GE007', '시물레이션');
INSERT INTO G_GENRE VALUES('GE008', '아케이드');
INSERT INTO G_GENRE VALUES('GE009', 'FPS');
INSERT INTO G_GENRE VALUES('GE010', '호러');

SELECT * FROM G_GENRE;

CREATE TABLE G_MEMBERS
(
    MID CHAR(4) NOT NULL PRIMARY KEY,
    MNAME VARCHAR2(30) NOT NULL,
    MGENDER VARCHAR2(3) NOT NULL,
    MAGE NUMBER(3) NOT NULL,
    MATEL VARCHAR2(11) NOT NULL,
    MADDR VARCHAR2(30) NOT NULL
);

INSERT INTO G_MEMBERS VALUES('M001','홍길동','M','22','01011111111','RG002');
INSERT INTO G_MEMBERS VALUES('M002','성춘향','F','19','01111112222','RG004');
INSERT INTO G_MEMBERS VALUES('M003','이몽룡','M','20','01611113333','RG001');
INSERT INTO G_MEMBERS VALUES('M004','심청','F','17','01711114444','RG002');
INSERT INTO G_MEMBERS VALUES('M005','심봉사','M','53','01671115555','RG003');
INSERT INTO G_MEMBERS VALUES('M006','콩쥐','F','25','01014116666','RG005');
INSERT INTO G_MEMBERS VALUES('M007','팥쥐','F','24','01012117777','RG003');
INSERT INTO G_MEMBERS VALUES('M008','흥부','M','36','01018118888','RG001');
INSERT INTO G_MEMBERS VALUES('M009','놀부','M','44','01015119999','RG005');
INSERT INTO G_MEMBERS VALUES('M010','방자','M','15','01012111564','RG002');
INSERT INTO G_MEMBERS VALUES('M011','신데렐라','F','26','01112311564','RG004');
INSERT INTO G_MEMBERS VALUES('M012','백설공주','F','23','01712511564','RG004');
INSERT INTO G_MEMBERS VALUES('M013','걸리버','M','49','01812111564','RG002');
INSERT INTO G_MEMBERS VALUES('M014','시골쥐','M','18','01012611564','RG002');
INSERT INTO G_MEMBERS VALUES('M015','서울쥐','F','19','01012811564','RG001');
INSERT INTO G_MEMBERS VALUES('M016','개미','M','28','01056872154','RG002');
INSERT INTO G_MEMBERS VALUES('M017','베짱이','F','20','01198516472','RG003');
INSERT INTO G_MEMBERS VALUES('M018','톰소여','M','16','01032578951','RG001');
INSERT INTO G_MEMBERS VALUES('M019','변사또','M','47','01923548795','RG001');
INSERT INTO G_MEMBERS VALUES('M020','앨리스','F','17','01732157892','RG001');

SELECT * FROM G_MEMBERS;

CREATE TABLE G_REGION
(
    RGID CHAR(5) NOT NULL,
    RGNAME VARCHAR(30) NOT NULL
);

INSERT INTO G_REGION VALUES('RG001','서울');
INSERT INTO G_REGION VALUES('RG002','부산');
INSERT INTO G_REGION VALUES('RG003','창원');
INSERT INTO G_REGION VALUES('RG004','울산');
INSERT INTO G_REGION VALUES('RG005','김해');

SELECT * FROM G_REGION;

CREATE TABLE G_STORE
(
    GID CHAR(4) NOT NULL,
    MID CHAR(4) NOT NULL,
    BUY_NUM NUMBER(2) NOT NULL,
    BUY_DATE DATE NOT NULL
);

INSERT INTO G_STORE VALUES('G001','M001',1,'2021-04-07');
INSERT INTO G_STORE VALUES('G005','M010',1,'2021-04-07');
INSERT INTO G_STORE VALUES('G007','M005',2,'2021-04-07');
INSERT INTO G_STORE VALUES('G010','M003',1,'2021-04-07');
INSERT INTO G_STORE VALUES('G001','M007',1,'2021-04-07');
INSERT INTO G_STORE VALUES('G012','M008',3,'2021-04-07');
INSERT INTO G_STORE VALUES('G013','M001',1,'2021-04-08');
INSERT INTO G_STORE VALUES('G008','M002',1,'2021-04-08');
INSERT INTO G_STORE VALUES('G004','M003',5,'2021-04-08');
INSERT INTO G_STORE VALUES('G003','M009',1,'2021-04-08');
INSERT INTO G_STORE VALUES('G019','M006',2,'2021-04-08');
INSERT INTO G_STORE VALUES('G018','M007',1,'2021-04-08');
INSERT INTO G_STORE VALUES('G015','M002',2,'2021-04-09');
INSERT INTO G_STORE VALUES('G012','M003',1,'2021-04-09');
INSERT INTO G_STORE VALUES('G011','M001',3,'2021-04-09');
INSERT INTO G_STORE VALUES('G006','M006',1,'2021-04-09');
INSERT INTO G_STORE VALUES('G017','M008',4,'2021-04-09');
INSERT INTO G_STORE VALUES('G002','M009',1,'2021-04-10');
INSERT INTO G_STORE VALUES('G001','M010',2,'2021-04-10');
INSERT INTO G_STORE VALUES('G010','M005',1,'2021-04-10');
INSERT INTO G_STORE VALUES('G014','M004',3,'2021-04-10');
INSERT INTO G_STORE VALUES('G027','M011',1,'2021-04-11');
INSERT INTO G_STORE VALUES('G026','M012',1,'2021-04-11');
INSERT INTO G_STORE VALUES('G021','M013',1,'2021-04-11');
INSERT INTO G_STORE VALUES('G020','M014',1,'2021-04-11');
INSERT INTO G_STORE VALUES('G030','M015',4,'2021-04-11');
INSERT INTO G_STORE VALUES('G023','M006',3,'2021-04-11');
INSERT INTO G_STORE VALUES('G025','M008',1,'2021-04-12');
INSERT INTO G_STORE VALUES('G024','M010',1,'2021-04-12');
INSERT INTO G_STORE VALUES('G027','M012',1,'2021-04-12');
INSERT INTO G_STORE VALUES('G028','M002',2,'2021-04-12');
INSERT INTO G_STORE VALUES('G029','M001',1,'2021-04-12');
INSERT INTO G_STORE VALUES('G026','M014',3,'2021-04-12');
INSERT INTO G_STORE VALUES('G019','M005',1,'2021-04-12');
INSERT INTO G_STORE VALUES('G019','M007',2,'2021-04-12');
INSERT INTO G_STORE VALUES('G020','M009',1,'2021-04-13');
INSERT INTO G_STORE VALUES('G022','M010',1,'2021-04-13');
INSERT INTO G_STORE VALUES('G027','M014',2,'2021-04-13');
INSERT INTO G_STORE VALUES('G023','M013',1,'2021-04-13');
INSERT INTO G_STORE VALUES('G029','M006',2,'2021-04-13');
INSERT INTO G_STORE VALUES('G030','M007',1,'2021-04-14');
INSERT INTO G_STORE VALUES('G040','M020',2,'2021-10-23');
INSERT INTO G_STORE VALUES('G029','M014',1,'2021-12-12');
INSERT INTO G_STORE VALUES('G027','M013',3,'2021-09-22');
INSERT INTO G_STORE VALUES('G029','M015',4,'2021-10-27');
INSERT INTO G_STORE VALUES('G043','M006',1,'2021-01-08');
INSERT INTO G_STORE VALUES('G005','M006',5,'2021-12-19');
INSERT INTO G_STORE VALUES('G006','M008',2,'2021-01-17');
INSERT INTO G_STORE VALUES('G030','M017',1,'2021-07-18');
INSERT INTO G_STORE VALUES('G009','M011',4,'2021-05-29');
INSERT INTO G_STORE VALUES('G001','M010',1,'2021-03-28');
INSERT INTO G_STORE VALUES('G034','M005',2,'2021-02-14');
INSERT INTO G_STORE VALUES('G017','M020',1,'2021-10-08');
INSERT INTO G_STORE VALUES('G014','M017',3,'2021-10-20');
INSERT INTO G_STORE VALUES('G007','M019',3,'2021-02-16');
INSERT INTO G_STORE VALUES('G016','M011',4,'2021-11-20');
INSERT INTO G_STORE VALUES('G038','M006',2,'2021-07-21');
INSERT INTO G_STORE VALUES('G008','M009',3,'2021-05-18');
INSERT INTO G_STORE VALUES('G020','M019',4,'2021-06-18');
INSERT INTO G_STORE VALUES('G043','M016',4,'2021-07-03');
INSERT INTO G_STORE VALUES('G043','M005',2,'2021-04-16');
INSERT INTO G_STORE VALUES('G044','M007',1,'2021-09-27');
INSERT INTO G_STORE VALUES('G035','M012',1,'2021-05-23');
INSERT INTO G_STORE VALUES('G013','M006',2,'2021-11-02');
INSERT INTO G_STORE VALUES('G003','M011',4,'2021-01-16');
INSERT INTO G_STORE VALUES('G024','M014',3,'2021-09-22');
INSERT INTO G_STORE VALUES('G019','M007',5,'2021-05-20');
INSERT INTO G_STORE VALUES('G010','M005',3,'2021-07-09');
INSERT INTO G_STORE VALUES('G014','M020',3,'2021-03-26');
INSERT INTO G_STORE VALUES('G003','M013',2,'2021-12-03');
INSERT INTO G_STORE VALUES('G011','M003',3,'2021-07-23');
INSERT INTO G_STORE VALUES('G017','M014',2,'2021-06-26');
INSERT INTO G_STORE VALUES('G031','M015',4,'2021-05-05');
INSERT INTO G_STORE VALUES('G027','M015',2,'2021-01-28');
INSERT INTO G_STORE VALUES('G044','M015',1,'2021-08-09');
INSERT INTO G_STORE VALUES('G007','M010',2,'2021-10-09');
INSERT INTO G_STORE VALUES('G020','M003',2,'2021-11-06');
INSERT INTO G_STORE VALUES('G040','M019',3,'2021-06-17');
INSERT INTO G_STORE VALUES('G034','M018',3,'2021-11-11');
INSERT INTO G_STORE VALUES('G032','M003',1,'2021-11-05');
INSERT INTO G_STORE VALUES('G031','M008',2,'2021-05-21');
INSERT INTO G_STORE VALUES('G033','M010',5,'2021-02-09');
INSERT INTO G_STORE VALUES('G006','M017',3,'2021-05-01');
INSERT INTO G_STORE VALUES('G004','M001',3,'2021-02-10');
INSERT INTO G_STORE VALUES('G004','M012',4,'2021-11-08');
INSERT INTO G_STORE VALUES('G017','M004',1,'2021-09-29');
INSERT INTO G_STORE VALUES('G044','M013',5,'2021-04-23');
INSERT INTO G_STORE VALUES('G045','M005',4,'2021-10-18');
INSERT INTO G_STORE VALUES('G031','M004',2,'2021-12-02');
INSERT INTO G_STORE VALUES('G024','M012',1,'2021-01-24');
INSERT INTO G_STORE VALUES('G005','M017',2,'2021-10-18');
INSERT INTO G_STORE VALUES('G001','M001',4,'2021-05-02');
INSERT INTO G_STORE VALUES('G006','M011',3,'2021-07-02');
INSERT INTO G_STORE VALUES('G025','M006',5,'2021-03-02');
INSERT INTO G_STORE VALUES('G041','M001',5,'2021-04-29');
INSERT INTO G_STORE VALUES('G014','M008',1,'2021-01-08');
INSERT INTO G_STORE VALUES('G035','M012',1,'2021-03-27');
INSERT INTO G_STORE VALUES('G034','M004',2,'2021-04-19');
INSERT INTO G_STORE VALUES('G003','M003',1,'2021-02-15');
INSERT INTO G_STORE VALUES('G037','M020',1,'2021-07-28');
INSERT INTO G_STORE VALUES('G025','M016',1,'2021-02-04');
INSERT INTO G_STORE VALUES('G034','M018',3,'2021-04-04');
INSERT INTO G_STORE VALUES('G006','M012',3,'2021-04-01');
INSERT INTO G_STORE VALUES('G040','M012',2,'2021-08-19');
INSERT INTO G_STORE VALUES('G019','M016',4,'2021-08-24');
INSERT INTO G_STORE VALUES('G035','M006',5,'2021-03-19');
INSERT INTO G_STORE VALUES('G013','M002',2,'2021-01-24');
INSERT INTO G_STORE VALUES('G030','M008',4,'2021-01-13');
INSERT INTO G_STORE VALUES('G012','M009',5,'2021-12-20');
INSERT INTO G_STORE VALUES('G009','M004',2,'2021-02-14');
INSERT INTO G_STORE VALUES('G003','M014',3,'2021-12-28');
INSERT INTO G_STORE VALUES('G015','M018',2,'2021-08-10');
INSERT INTO G_STORE VALUES('G006','M019',5,'2021-09-11');
INSERT INTO G_STORE VALUES('G007','M001',3,'2021-10-09');
INSERT INTO G_STORE VALUES('G014','M004',5,'2021-11-10');
INSERT INTO G_STORE VALUES('G016','M016',4,'2021-09-28');
INSERT INTO G_STORE VALUES('G039','M012',4,'2021-06-29');
INSERT INTO G_STORE VALUES('G012','M007',1,'2021-09-03');
INSERT INTO G_STORE VALUES('G014','M009',1,'2021-12-10');
INSERT INTO G_STORE VALUES('G021','M005',5,'2021-07-28');
INSERT INTO G_STORE VALUES('G002','M002',5,'2021-08-06');
INSERT INTO G_STORE VALUES('G024','M016',2,'2021-09-26');
INSERT INTO G_STORE VALUES('G029','M005',4,'2021-05-22');
INSERT INTO G_STORE VALUES('G023','M002',4,'2021-11-27');
INSERT INTO G_STORE VALUES('G008','M013',4,'2021-06-02');
INSERT INTO G_STORE VALUES('G012','M013',3,'2021-06-03');
INSERT INTO G_STORE VALUES('G018','M006',5,'2021-02-21');
INSERT INTO G_STORE VALUES('G045','M011',3,'2021-10-28');
INSERT INTO G_STORE VALUES('G031','M009',4,'2021-04-23');
INSERT INTO G_STORE VALUES('G010','M019',4,'2021-03-09');
INSERT INTO G_STORE VALUES('G021','M003',1,'2021-06-01');
INSERT INTO G_STORE VALUES('G015','M018',5,'2021-09-05');
INSERT INTO G_STORE VALUES('G037','M006',4,'2021-04-02');
INSERT INTO G_STORE VALUES('G036','M014',5,'2021-01-18');
INSERT INTO G_STORE VALUES('G029','M003',5,'2021-12-02');
INSERT INTO G_STORE VALUES('G005','M010',2,'2021-01-03');
INSERT INTO G_STORE VALUES('G032','M013',1,'2021-06-17');
INSERT INTO G_STORE VALUES('G035','M005',5,'2021-03-04');
INSERT INTO G_STORE VALUES('G008','M009',4,'2021-11-17');
INSERT INTO G_STORE VALUES('G022','M013',3,'2021-11-06');
INSERT INTO G_STORE VALUES('G030','M011',3,'2021-01-18');

SELECT * FROM G_STORE;

--ROLLBACK;
--COMMIT;



------------------------------------------------1일차

--1.부산에서 게임을 구매한 사람중 남자의 총 매출

--2.스타크래프트를 구매한 사람을 지역별로 표시하시오 결과 지역 : 몇명

--3.서울에서 구매한 게임의 종류를 표시하시오 결과는 서울 : 게임이름

--4.오버워치의 총 매출을 표시하시오 결과는 오버워치 : 얼마

-------------------------------------------------2일차

--5.FPS를 구매한 남자중 총 가격의 합계
 
--6.롤플레잉을 구매한 사람중 1개를 구매한 사람들을 나열하시오
 
--7.서울에서 구매하지않은 장르는?
  
--8.전화번호 앞자리가 010인사람의 지역별 총 가격과 장르를 표시하시오

-------------------------------------------------3일차

SELECT * FROM GAMES;
SELECT * FROM G_MEMBERS;
SELECT * FROM G_STORE;
SELECT * FROM G_GENRE;

--9.모든 디아블로를 구매한 사람중 가장 구매비용이 높은 사람은?
    
--10.롤플레잉 장르의 총 매출평균보다  총 매출평균이 높은 장르는?

--11.4월 한달간 몇월 몇일에 게임구매가 이루어졌는지 나타내시오
--예) 4월 1일 0개
    
--12.4월 8일에 팔린 게임을 남녀 구분해서 몇개 구매되었는지 나타내시오
--예) 남성 0개
--   여성 0개

--13. 4월 8일 부터 14일중 모든 오버워치의 총매출 보다 총매출이 높은 게임중 총 매출이 가장 낮은 게임과 게임이 팔린 날짜를 나타내시오 
--창목전용 문제 파이팅!

 SELECT GNAME, GAMASPRICE, BUY_DATE
    FROM (
        SELECT GNAME, GAMASPRICE, BUY_DATE, RANK() OVER(ORDER BY GAMASPRICE ASC) AS RNK 
        FROM
        (
            SELECT T1.GNAME ,SUM(T1.GPRICE * T2.BUY_NUM) AS GAMASPRICE, T2.BUY_DATE
            FROM G_GAMES T1, G_STORE T2
            WHERE T1.GID = T2.GID
            AND (TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'MM')) = 4 AND TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'DD')) >= 8 AND TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'DD')) <= 14) 
            GROUP BY T1.GNAME,  T2.BUY_DATE
        )
        WHERE GAMASPRICE >  
        (
            SELECT SUM(T1.GPRICE * T2.BUY_NUM)
            FROM G_GAMES T1, G_STORE T2
            WHERE T1.GID = T2.GID
            AND T1.GNAME LIKE '오버워치%'
            AND (TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'MM')) = 4 AND TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'DD')) >= 8 AND TO_NUMBER(TO_CHAR(T2.BUY_DATE, 'DD')) <= 14) 
        )
    )
    WHERE RNK = 1
    ;