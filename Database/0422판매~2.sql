CREATE TABLE EMPLOYEE_TBL
(
    E_ID        CHAR(4)     NOT NULL  PRIMARY KEY, -- »ç¿ø¾ÆÀÌµð
    E_NAME      VARCHAR2(30)    NOT NULL,          --»ç¿øÀÌ¸§
    PART_ID     CHAR(6)         NOT NULL           --¼Ò¼ÓºÎ¼­, ÆÀ
);

INSERT INTO EMPLOYEE_TBL VALUES('E001','È«±æµ¿1','PT0002');  --ÀÎ»çºÎ
INSERT INTO EMPLOYEE_TBL VALUES('E002','È«±æµ¿2','PT0002');  --ÀÎ»çºÎ
INSERT INTO EMPLOYEE_TBL VALUES('E003','È«±æµ¿3','PT0002');  --ÀÎ»çºÎ
INSERT INTO EMPLOYEE_TBL VALUES('E004','È«±æµ¿4','PT0011');  --ÃÑ¹«ºÎ 1-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E005','È«±æµ¿5','PT0011');  --ÃÑ¹«ºÎ 1-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E006','È«±æµ¿6','PT0012');  --ÃÑ¹«ºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E007','È«±æµ¿7','PT0012');  --ÃÑ¹«ºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E008','È«±æµ¿8','PT0012');  --ÃÑ¹«ºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E009','È«±æµ¿9','PT0013');  --ÃÑ¹«ºÎ 2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E010','È«±æµ¿10','PT0013'); --ÃÑ¹«ºÎ 2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E011','È«±æµ¿11','PT0014'); --ÃÑ¹«ºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E012','È«±æµ¿12','PT0014'); --ÃÑ¹«ºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E013','È«±æµ¿13','PT0014'); --ÃÑ¹«ºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E014','È«±æµ¿14','PT0014'); --ÃÑ¹«ºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E015','È«±æµ¿15','PT0015'); --ÃÑ¹«ºÎ 3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E016','È«±æµ¿16','PT0015'); --ÃÑ¹«ºÎ 3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E017','È«±æµ¿17','PT0037'); --ÃÑ¹«ºÎ 3-2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E018','È«±æµ¿18','PT0037'); --ÃÑ¹«ºÎ 3-2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E019','È«±æµ¿19','PT0038'); --ÃÑ¹«ºÎ 3-2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E020','È«±æµ¿20','PT0038'); --ÃÑ¹«ºÎ 3-2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E021','È«±æµ¿21','PT0017'); --ÃÑ¹«ºÎ 3-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E022','È«±æµ¿22','PT0017'); --ÃÑ¹«ºÎ 3-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E023','È«±æµ¿23','PT0018'); --»ý»êºÎ 1-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E024','È«±æµ¿24','PT0018'); --»ý»êºÎ 1-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E025','È«±æµ¿25','PT0018'); --»ý»êºÎ 1-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E026','È«±æµ¿26','PT0019'); --»ý»êºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E027','È«±æµ¿27','PT0019'); --»ý»êºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E028','È«±æµ¿28','PT0019'); --»ý»êºÎ 1-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E029','È«±æµ¿29','PT0020'); --»ý»êºÎ 1-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E030','È«±æµ¿30','PT0020'); --»ý»êºÎ 1-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E031','È«±æµ¿31','PT0020'); --»ý»êºÎ 1-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E032','È«±æµ¿32','PT0020'); --»ý»êºÎ 1-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E033','È«±æµ¿33','PT0021'); --»ý»êºÎ 1-4ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E034','È«±æµ¿34','PT0021'); --»ý»êºÎ 1-4ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E035','È«±æµ¿35','PT0021'); --»ý»êºÎ 1-4ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E036','È«±æµ¿36','PT0021'); --»ý»êºÎ 1-4ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E037','È«±æµ¿37','PT0021'); --»ý»êºÎ 1-4ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E038','È«±æµ¿38','PT0022'); --»ý»êºÎ 2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E039','È«±æµ¿39','PT0022'); --»ý»êºÎ 2-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E040','È«±æµ¿40','PT0023'); --»ý»êºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E041','È«±æµ¿41','PT0023'); --»ý»êºÎ 2-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E042','È«±æµ¿42','PT0024'); --»ý»êºÎ 3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E043','È«±æµ¿43','PT0024'); --»ý»êºÎ 3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E044','È«±æµ¿44','PT0025'); --»ý»êºÎ 3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E045','È«±æµ¿45','PT0025'); --»ý»êºÎ 3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E046','È«±æµ¿46','PT0025'); --»ý»êºÎ 3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E047','È«±æµ¿47','PT0039'); --»ý»êºÎ 3-3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E048','È«±æµ¿48','PT0039'); --»ý»êºÎ 3-3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E049','È«±æµ¿49','PT0039'); --»ý»êºÎ 3-3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E050','È«±æµ¿50','PT0039'); --»ý»êºÎ 3-3-1ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E051','È«±æµ¿51','PT0040'); --»ý»êºÎ 3-3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E052','È«±æµ¿52','PT0040'); --»ý»êºÎ 3-3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E053','È«±æµ¿53','PT0040'); --»ý»êºÎ 3-3-2ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E054','È«±æµ¿54','PT0041'); --»ý»êºÎ 3-3-3ÆÀ
INSERT INTO EMPLOYEE_TBL VALUES('E055','È«±æµ¿55','PT0041'); --»ý»êºÎ 3-3-3ÆÀ

SELECT * FROM EMPLOYEE_TBL;
--COMMIT;

CREATE TABLE PARTS_TBL --ºÎ¼­, ÆÀ Å×ÀÌºí
(
    PART_ID     CHAR(6)         NOT NULL,   --ºÎ¼­, ÆÀ ¾ÆÀÌµð
    PART_NAME   VARCHAR2(30)    NOT NULL,   --ºÎ¼­, ÆÀ ÀÌ¸§
    PART_LVL    NUMBER(4)       NOT NULL,   --ºÎ¼­, ÆÀ ·¹º§
    PART_SEQ    NUMBER(4)       NOT NULL,   --Á¤·Ä¼ø¼­¸¦ ³ªÅ¸³»´Â ¼ø¼­°ª
    PARENT_PART_ID  CHAR(6)     NULL        --ºÎ¼­, ÆÀÀÇ ºÎ¸ð¾ÆÀÌµð(PARENT ID)
);

--DROP TABLE PARTS_TBL;
INSERT INTO PARTS_TBL VALUES('PT0001','ROOT',0, 1, NULL);


INSERT INTO PARTS_TBL VALUES('PT0002','ÀÎ»çºÎ',1, 1, 'PT0001');
INSERT INTO PARTS_TBL VALUES('PT0003','ÃÑ¹«ºÎ',1, 2, 'PT0001');
INSERT INTO PARTS_TBL VALUES('PT0004','»ý»êºÎ',1, 3, 'PT0001');

INSERT INTO PARTS_TBL VALUES('PT0005','ÃÑ¹«ºÎ 1ÆÀ',2, 1, 'PT0003');
INSERT INTO PARTS_TBL VALUES('PT0006','ÃÑ¹«ºÎ 2ÆÀ',2, 2, 'PT0003');
INSERT INTO PARTS_TBL VALUES('PT0007','ÃÑ¹«ºÎ 3ÆÀ',2, 3, 'PT0003');

INSERT INTO PARTS_TBL VALUES('PT0008','»ý»êºÎ 1ÆÀ',2, 1, 'PT0004');
INSERT INTO PARTS_TBL VALUES('PT0009','»ý»êºÎ 2ÆÀ',2, 2, 'PT0004');
INSERT INTO PARTS_TBL VALUES('PT0010','»ý»êºÎ 3ÆÀ',2, 3, 'PT0004');

INSERT INTO PARTS_TBL VALUES('PT0011','ÃÑ¹«ºÎ 1-1ÆÀ',3, 1, 'PT0005');
INSERT INTO PARTS_TBL VALUES('PT0012','ÃÑ¹«ºÎ 1-2ÆÀ',3, 2, 'PT0005');

INSERT INTO PARTS_TBL VALUES('PT0013','ÃÑ¹«ºÎ 2-1ÆÀ',3, 1, 'PT0006');
INSERT INTO PARTS_TBL VALUES('PT0014','ÃÑ¹«ºÎ 2-2ÆÀ',3, 2, 'PT0006');

INSERT INTO PARTS_TBL VALUES('PT0015','ÃÑ¹«ºÎ 3-1ÆÀ',3, 1, 'PT0007');
INSERT INTO PARTS_TBL VALUES('PT0016','ÃÑ¹«ºÎ 3-2ÆÀ',3, 2, 'PT0007');
INSERT INTO PARTS_TBL VALUES('PT0017','ÃÑ¹«ºÎ 3-3ÆÀ',3, 3, 'PT0007');

INSERT INTO PARTS_TBL VALUES('PT0018','»ý»êºÎ 1-1ÆÀ',3, 1, 'PT0008');
INSERT INTO PARTS_TBL VALUES('PT0019','»ý»êºÎ 1-2ÆÀ',3, 2, 'PT0008');
INSERT INTO PARTS_TBL VALUES('PT0020','»ý»êºÎ 1-3ÆÀ',3, 3, 'PT0008');
INSERT INTO PARTS_TBL VALUES('PT0021','»ý»êºÎ 1-4ÆÀ',3, 4, 'PT0008');

INSERT INTO PARTS_TBL VALUES('PT0022','»ý»êºÎ 2-1ÆÀ',3, 1, 'PT0009');
INSERT INTO PARTS_TBL VALUES('PT0023','»ý»êºÎ 2-2ÆÀ',3, 2, 'PT0009');

INSERT INTO PARTS_TBL VALUES('PT0024','»ý»êºÎ 3-1ÆÀ',3, 1, 'PT0010');
INSERT INTO PARTS_TBL VALUES('PT0025','»ý»êºÎ 3-2ÆÀ',3, 2, 'PT0010');
INSERT INTO PARTS_TBL VALUES('PT0026','»ý»êºÎ 3-3ÆÀ',3, 3, 'PT0010');

INSERT INTO PARTS_TBL VALUES('PT0037','ÃÑ¹«ºÎ 3-2-1ÆÀ',4, 1, 'PT0016');
INSERT INTO PARTS_TBL VALUES('PT0038','ÃÑ¹«ºÎ 3-2-2ÆÀ',4, 2, 'PT0016');

INSERT INTO PARTS_TBL VALUES('PT0039','»ý»êºÎ 3-3-1ÆÀ',4, 1, 'PT0026');
INSERT INTO PARTS_TBL VALUES('PT0040','»ý»êºÎ 3-3-2ÆÀ',4, 2, 'PT0026');
INSERT INTO PARTS_TBL VALUES('PT0041','»ý»êºÎ 3-3-3ÆÀ',4, 3, 'PT0026');

SELECT * FROM PARTS_TBL;

--COMMIT;
SELECT * FROM EMPLOYEE_TBL;
SELECT * FROM PARTS_TBL;

--1. °èÃþÇü µ¥ÀÌÅÍ¿¡ ´ëÇÑ ÀÌÇØ
--2. °èÃþÇü Äõ¸® ¿¡ ´ëÇÑ ÀÌÇØ -- ¿À¶óÅ¬ 10G ¹öÀüÀÌ»óºÎÅÍ ¹®Á¦¾øÀÌ µ¿ÀÛ
-- °èÃþÇü Äõ¸®¿¡´Â ROOT°¡ ÀÖ°í ÀüÃ¼¸¦ ¾Æ¿ì¸£´Â ¹«¾ð°¡°¡ ÇÊ¿äÇÏ´Ù 

    SELECT *
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0001' -- °¡Àå À§ ¶Ç´Â ¾Æ·¡ Áï ±âÁØ
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID -- ÀÚ½ÅÀÇ ¾ÆÀÌµð¸¦ ºÎ¸ðÀÇ ¾ÆÀÌµð·Î °®°í ÀÖ´Â ¾ÆÀÌ´Â ÀÚ½ÄÀÌ´Ù
    ;
    
    -- ÃÑ¹«ºÎ¸¸ »Ì¾ÆºÁ
    
    SELECT * 
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0003'
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID
    ;
    
    --PART¸¦ ÇÑ±Û¼øÀ¸·Î Á¤·Ä
    
    SELECT *
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0001'
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID
    --11ºÎÅÍ Áö¿ø
    ORDER SIBLINGS BY PART_NAME -- °èÃþÇüÀ» ±úÁö ¾Ê°í Á¤·ÄÇÑ´Ù
    ;
    
--3. °èÃþÇü µ¥ÀÌÅÍ¸¦ °¡Áö°í ÀÖ´Â Å×ÀÌºí°úÀÇ Á¶ÀÎ


SELECT * FROM EMPLOYEE_TBL;

SELECT * FROM PARTS_TBL;

SELECT *
FROM
(
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 1
) PART1,
(
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 2
) PART2,
(
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 3
) PART3,
(
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 4
) PART4
WHERE PART1.PART_ID = PART2.PARENT_PART_ID(+)
AND PART2.PART_ID = PART3.PARENT_PART_ID(+)
AND PART3.PART_ID = PART4.PARENT_PART_ID(+)
;
----------------------------------------- ÀÌ·¸°Ô ÇÏ¸é »ç¿ø Å×ÀÌºíÀ» ¿¬°áÇÏ±â ¾î·Æ´Ù
SELECT * FROM
(
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 4
) P4, (
SELECT * FROM PARTS_TBL
WHERE PART_LVL = 3
) P3
WHERE P4.PARENT_PART_ID = P3.PART_ID(+)
;

SELECT * FROM PARTS_TBL T1, PARTS_TBL T2, PARTS_TBL T3, PARTS_TBL T4
WHERE T1.PART_ID = T2.PARENT_PART_ID(+)
AND T2.PART_ID = T3.PARENT_PART_ID(+)
AND T3.PART_ID = T4.PARENT_PART_ID(+)
;

SELECT * 
FROM PARTS_TBL T1, PARTS_TBL T2, PARTS_TBL T3, PARTS_TBL T4
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
AND T2.PART_ID(+) = T3.PARENT_PART_ID
AND T3.PART_ID(+) = T4.PARENT_PART_ID
;

SELECT * FROM PARTS_TBL T1, PARTS_TBL T2
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
;
--µ¥ÀÌÅÍ¸¦ ³¡±îÁö À¯ÁöÇÏ°í ½ÍÀ» ¶§ ´Ù¸¦ 1¿¡´Ù°¡ °Ç´Ù

SELECT TRIM(DECODE(T1.PART_NAME ,'ROOT', ' ', NULL, ' ',T1.PART_NAME) || ' ' || 
       DECODE(T2.PART_NAME ,'ROOT', ' ', NULL, ' ',T2.PART_NAME) || ' ' || 
       DECODE(T3.PART_NAME ,'ROOT', ' ', NULL, ' ',T3.PART_NAME) || ' ' || 
       DECODE(T4.PART_NAME ,'ROOT', ' ', NULL, ' ',T4.PART_NAME)
       ) AS PART, T5.E_NAME
FROM PARTS_TBL T1, PARTS_TBL T2, PARTS_TBL T3, PARTS_TBL T4, EMPLOYEE_TBL T5
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
AND T2.PART_ID(+) = T3.PARENT_PART_ID
AND T3.PART_ID(+) = T4.PARENT_PART_ID
AND T4.PART_ID = T5.PART_ID
;

------------------------¾ß¸ÅÇ®ÀÌ
SELECT NVL(T4.PART_NAME,'»óÀ§ºÎ¼­¾øÀ½') AS PART1,NVL(T3.PART_NAME,'»óÀ§ºÎ¼­¾øÀ½') AS PART2,NVL(T1.PART_NAME,'»óÀ§ºÎ¼­¾øÀ½') AS PART3,T2.PART_NAME AS PART4,T2.E_NAME
FROM 
(
    SELECT *
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0001'
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID 
) T1,
(
SELECT T1.PART_ID,T1.PART_NAME, T1.PART_LVL, T1.PART_SEQ, T1.PARENT_PART_ID, T2.E_ID, T2.E_NAME
FROM
PARTS_TBL T1,EMPLOYEE_TBL T2
WHERE T2.PART_ID = T1.PART_ID
START WITH T2.E_ID = 'E010'
CONNECT BY PRIOR T2.PART_ID = T1.PARENT_PART_ID
) T2
,(
    SELECT *
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0001'
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID 
) T3,
(
    SELECT *
    FROM PARTS_TBL
    START WITH PART_ID = 'PT0001'
    CONNECT BY PRIOR PART_ID = PARENT_PART_ID 
) T4
WHERE T1.PART_ID(+) = T2.PARENT_PART_ID
AND T1.PARENT_PART_ID = T3.PART_ID(+)
AND T3.PARENT_PART_ID = T4.PART_ID(+)
;
------------------------------------------------------------------------------------------

SELECT *
FROM PARTS_TBL
;

SELECT PART_ID, PART_NAME, PART_LVL, PART_SEQ, PARENT_PART_ID, LEVEL
FROM PARTS_TBL
START WITH PART_ID = 'PT0001' OR PART_ID = 'PT0005'
CONNECT BY PRIOR  PART_ID = PARENT_PART_ID  
;

SELECT *
FROM PARTS_TBL
START WITH PART_ID = 'PT0007'
CONNECT BY PRIOR PARENT_PART_ID = PART_ID
;